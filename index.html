<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whispers in Shadowbrook ¬∑ supernatural mystery</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Georgia', 'Times New Roman', serif;
        }
        body {
            background: #0b1a1e;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 16px;
        }
        .game-container {
            max-width: 800px;
            width: 100%;
            background: #1e2b2f;
            border-radius: 32px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.8), 0 0 0 2px #4a3b2b inset;
            padding: 24px;
            border: 1px solid #7e6b4f;
        }
        .title-panel {
            text-align: center;
            margin-bottom: 20px;
        }
        .title-panel h1 {
            color: #ebd6b0;
            text-shadow: 0 0 8px #6b4f3a, 0 2px 0 #2a1e14;
            font-size: 2.4rem;
            letter-spacing: 6px;
            margin: 0;
            font-weight: normal;
            border-bottom: 2px dashed #6e5b48;
            padding-bottom: 10px;
        }
        .story-pane {
            background: #271f18;
            border: 3px ridge #9b8569;
            border-radius: 30px;
            padding: 28px 24px;
            min-height: 280px;
            color: #efe3cc;
            font-size: 1.25rem;
            line-height: 1.6;
            box-shadow: inset 0 0 30px #0a0806;
            text-shadow: 0 1px 2px black;
            white-space: pre-wrap;
            margin-bottom: 28px;
            background-image: radial-gradient(circle at 30% 40%, #3f3328 2px, transparent 2px), 
                              radial-gradient(circle at 70% 80%, #3f3328 1px, transparent 2px);
            background-size: 40px 40px;
        }
        .choices-area {
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin-top: 20px;
        }
        .choice-btn {
            background: #2b3a40;
            border: 2px solid #b7a17e;
            color: #f7eedb;
            font-size: 1.2rem;
            padding: 16px 22px;
            border-radius: 60px;
            cursor: pointer;
            text-align: left;
            font-weight: 500;
            letter-spacing: 0.4px;
            box-shadow: 0 6px 0 #142126, 0 8px 10px black;
            transition: all 0.07s;
            backdrop-filter: blur(2px);
        }
        .choice-btn:hover {
            background: #3f535c;
            border-color: #e4ccaa;
            transform: translateY(-2px);
            box-shadow: 0 8px 0 #142126, 0 12px 18px black;
        }
        .choice-btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #142126, 0 5px 10px black;
        }
        .utility-bar {
            display: flex;
            justify-content: flex-end;
            margin-top: 28px;
        }
        .restart-btn {
            background: none;
            border: 2px solid #6f5e49;
            color: #c9b696;
            font-size: 1rem;
            padding: 8px 22px;
            border-radius: 40px;
            cursor: pointer;
            font-family: inherit;
            transition: 0.2s;
            letter-spacing: 1px;
        }
        .restart-btn:hover {
            background: #3f3227;
            color: #f3dfc4;
            border-color: #b59f7b;
        }
        .status-tag {
            color: #bda78b;
            font-size: 0.9rem;
            margin-top: 10px;
            text-align: right;
            font-style: italic;
            border-top: 1px dotted #6b5b47;
            padding-top: 12px;
        }
    </style>
</head>
<body>
<div class="game-container">
    <div class="title-panel">
        <h1>SHADOWBROOK</h1>
    </div>
    <div id="storyText" class="story-pane">
        <!-- story appears here -->
    </div>
    <div id="choicesContainer" class="choices-area">
        <!-- choice buttons dynamically -->
    </div>
    <div class="utility-bar">
        <button id="restartBtn" class="restart-btn">‚ü≤ restart the mystery</button>
    </div>
    <div id="inventoryInfo" class="status-tag">
        <!-- clues / flags appear here -->
    </div>
</div>

<script>
    (function() {
        // ---------- GAME STATE ----------
        let gameState = {
            // clues / flags (don't spoil, just tracking)
            talkedMartha: false,
            metGhost: false,
            libraryClue: false,
            sheriffTrust: false,
            cemeteryVisited: false,
            shadowAmulet: false,
            diaryFound: false,
            shadowManRevealed: false,
            eldritchSecret: false,
            // which scene we are on
            currentSceneId: 'intro'
        };

        // ---------- SCENE DEFINITIONS (branching narrative, no spoilers upfront) ----------
        const scenes = {
            // --- INTRO / START ---
            intro: {
                desc: `October mist clings to the pines as you cross the town line. SHADOWBROOK ‚Äî population 892 ‚Äî welcomes you with flickering streetlamps. You're here to investigate the strange death of historian Elias Thorne. Sheriff Hayes ruled it an accident, but something gnaws at you.\n\nThe innkeeper at the WHISPERING PINES INN, Martha, wipes a glass as you enter. "You must be the journalist. Room 7, last one at the end. Elias used to stay there, you know... before." She stares into the distance.`,
                choices: [
                    { text: "üëâ Press Martha for more about Elias", nextScene: 'marthaTalk' },
                    { text: "üõå Go to your room, rest and think", nextScene: 'roomFirstNight' },
                    { text: "üö∂ Take a walk through the foggy town", nextScene: 'townWalk' }
                ]
            },
            marthaTalk: {
                desc: `Martha sighs, wringing a rag. "Elias was here almost every night, researching old deeds and town records. Lately he seemed haunted ‚Äî muttered about a 'shadow man' watching him from the woods. I thought it was just his imagination... then the stairs broke. Or so they say." She leans closer: "His room is still locked. Sheriff took the key, but I got a spare. You didn't hear it from me."`,
                choices: [
                    { text: "üóùÔ∏è Ask for the spare key to Elias's room", nextScene: 'getKey', action: ()=> { gameState.talkedMartha = true; } },
                    { text: "üå≤ Go for that walk first", nextScene: 'townWalk' },
                    { text: "üõå Rest for now", nextScene: 'roomFirstNight' }
                ]
            },
            getKey: {
                desc: `Martha slides a rusty key across the counter. "Don't tell anyone. Room 7... but be careful. Strange sounds come from there at night." You pocket the key.`,
                choices: [
                    { text: "üîë Go directly to Elias's room", nextScene: 'eliasRoom' },
                    { text: "üè® Go outside, maybe later", nextScene: 'townWalk' }
                ]
            },
            roomFirstNight: {
                desc: `You lie down but sleep doesn't come. At 2:13 AM, floorboards creak in the hallway ‚Äî soft, deliberate. Through the door crack you see a flicker of lantern light, then nothing. In the morning, a small envelope slides under your door: a torn page from Elias's diary: "the shadow knows the old way... beneath the chapel..."`,
                choices: [
                    { text: "üîç Investigate the old chapel (north of town)", nextScene: 'oldChapel' },
                    { text: "üìö Visit the town library first", nextScene: 'library' },
                    { text: "üèõÔ∏è Talk to Sheriff Hayes", nextScene: 'sheriffOffice' }
                ]
            },
            townWalk: {
                desc: `Fog swirls along Main Street. You pass the darkened library, the sheriff's office (light on), and the old cemetery where willows weep. A hunched figure lingers by the gate ‚Äî then vanishes behind a tombstone. Did you imagine it?`,
                choices: [
                    { text: "‚ö∞Ô∏è Enter the cemetery", nextScene: 'cemeteryEncounter' },
                    { text: "üìñ Try the library", nextScene: 'library' },
                    { text: "üèõÔ∏è Sheriff's office", nextScene: 'sheriffOffice' }
                ]
            },
            cemeteryEncounter: {
                desc: `Gravestones lean like tired sentinels. You find fresh flowers on Elias Thorne's grave ‚Äî and a whisper behind you: "He shouldn't have dug up the past." You spin around. A translucent figure in old-fashioned clothes points toward the woods and fades. A cold spot lingers. On the grave, a small amulet with a swirling stone lies half-hidden.`,
                choices: [
                    { text: "ü™¨ Take the strange amulet", nextScene: 'takeAmulet', action: ()=> { gameState.shadowAmulet = true; gameState.cemeteryVisited = true; } },
                    { text: "üèÉ Leave it and run to the library", nextScene: 'library' }
                ]
            },
            takeAmulet: {
                desc: `The amulet hums faintly in your palm. For a moment, you see a shadow flit between the trees ‚Äî taller than a man, darker than night. It's gone. You feel watched.`,
                choices: [
                    { text: "üìö Go to the library now", nextScene: 'library' },
                    { text: "üèõÔ∏è Show it to the sheriff", nextScene: 'sheriffOffice' }
                ]
            },
            library: {
                desc: `The Shadowbrook library smells of dust and old leather. The librarian, Ms. Crain, peers at you over half-moon glasses. "Elias spent hours in the archives. He was obsessed with the town's founding family ‚Äî the Varnes. They vanished in 1889 after a fire. He believed they didn't die... they went underground." She hands you a crumbling map: "Found this in his usual spot." The map marks a hidden root cellar near the old chapel.`,
                choices: [
                    { text: "üó∫Ô∏è Head to the root cellar", nextScene: 'cellar', action: ()=> { gameState.libraryClue = true; } },
                    { text: "üèõÔ∏è Tell the sheriff about this", nextScene: 'sheriffOffice' },
                    { text: "üîë Return to the inn / Elias's room", nextScene: 'eliasRoom' }
                ]
            },
            sheriffOffice: {
                desc: `Sheriff Hayes is a solid man with tired eyes. "Elias? Tragic accident. Case closed." He seems eager to change the subject. If you mention the shadow man or the Varnes, his jaw tightens. "Old wives' tales. Leave it alone." You notice a Varnes family Bible on his shelf, hidden behind a stack of files.`,
                choices: [
                    { text: "ü§ù Act friendly, ask about the Bible", nextScene: 'sheriffBible', action: ()=> { gameState.sheriffTrust = true; } },
                    { text: "üò† Press him ‚Äî you don't buy the accident", nextScene: 'sheriffConfront' }
                ]
            },
            sheriffBible: {
                desc: `Hayes reluctantly hands you the Bible. "Found it in Elias's room. He wanted me to keep it safe." Inside, a page is marked: "Varnes line ended? or hiding beneath?" Handwritten notes mention a "shadow covenant" and a ritual every 50 years. The next is tomorrow ‚Äî Halloween.`,
                choices: [
                    { text: "üîÆ Investigate the ritual site (old chapel)", nextScene: 'oldChapel' },
                    { text: "üìú Go to Elias's room again", nextScene: 'eliasRoom' }
                ]
            },
            sheriffConfront: {
                desc: `Hayes's face darkens. "I warned you." He ushers you out. But as you leave, he mutters: "The shadow takes those who dig too deep. Forget it, if you value your soul."`,
                choices: [
                    { text: "üò® Return to the inn, shaken", nextScene: 'roomLater' },
                    { text: "üå≤ Ignore him ‚Äî go to the woods", nextScene: 'cellar' }
                ]
            },
            eliasRoom: {
                desc: `You unlock Room 7. It's tidy except for a scattered notebook. Sketches of occult symbols, a family tree ending in fire. One page reads: "The shadow man is real ‚Äî not a ghost, but a guardian. It guards the Varnes' secret. They found immortality beneath the chapel. Elias, you're a fool. But I must know." A loose floorboard hides a diary.`,
                choices: [
                    { text: "üìñ Read the hidden diary", nextScene: 'diaryRevelation', action: ()=> { gameState.diaryFound = true; } },
                    { text: "üèÉ Go to the chapel now", nextScene: 'oldChapel' }
                ]
            },
            diaryRevelation: {
                desc: `Elias's diary: "Oct 28 ‚Äî I found the entrance. The Varnes didn't die; they sleep. The shadow man is their sentinel. If I perform the rite at midnight on Halloween, I can wake them ‚Äî or bind them forever. But the sentinel will try to stop me. I need the amulet of the first Varnes, buried in the old cemetery."`,
                choices: [
                    { text: "‚ö∞Ô∏è You have the amulet? (if you took it)", nextScene: 'finalApproach', condition: () => gameState.shadowAmulet },
                    { text: "ü™¶ Go find the amulet in the cemetery", nextScene: 'cemeteryEncounter' },
                    { text: "‚õ™ Rush to the chapel without amulet", nextScene: 'chapelNoAmulet' }
                ]
            },
            oldChapel: {
                desc: `The chapel is a crumbling stone shell. Behind the altar, a trapdoor leads down ‚Äî just as the map showed. Faint chanting echoes from below. The air is icy.`,
                choices: [
                    { text: "‚¨áÔ∏è Descend into the darkness", nextScene: 'finalApproach' },
                    { text: "üò∞ Go back for backup (sheriff?)", nextScene: 'sheriffOfficeFinal' }
                ]
            },
            sheriffOfficeFinal: {
                desc: `You burst into the sheriff's office. Hayes looks up, weary. "You found something." You explain. He sighs: "My family has guarded this secret for generations. Tonight it ends. I'll come with you." He grabs a lantern and an old revolver. Together you return to the chapel.`,
                choices: [
                    { text: "üë• Go down together", nextScene: 'finalWithSheriff' }
                ]
            },
            cellar: {
                desc: `The root cellar behind the chapel is filled with decayed crates. But one wall is false ‚Äî beyond it, a narrow tunnel descends into the earth. The amulet grows warm.`,
                choices: [
                    { text: "üö∂ Enter the tunnel", nextScene: 'finalApproach' },
                    { text: "üîô Go back and get the sheriff", nextScene: 'sheriffOfficeFinal' }
                ]
            },
            // --- FINAL SCENES / ENDINGS (various, no single spoiler) ---
            chapelNoAmulet: {
                desc: `You descend without the amulet. In the vault, seven hooded figures stand around a stone altar. The shadow man ‚Äî a towering wraith ‚Äî turns to you. "You are not the heir." It reaches for you. You try to run, but the tunnel shifts... You wake in your inn room, the door ajar. A note: "Leave Shadowbrook. Forever." You leave, but the mystery haunts your dreams. (END: Driven away)`,
                choices: [ { text: "‚ú® Restart the mystery", nextScene: 'intro' } ]
            },
            finalApproach: {
                desc: `You stand before a vast underground chamber. Seven sarcophagi line the walls ‚Äî the Varnes. The shadow man looms, whispering: "Bearer of the amulet, you may either wake them or seal them. Choose." In your hand, the amulet pulses.`,
                choices: [
                    { text: "üîÆ Wake the Varnes (unlock immortality?)", nextScene: 'endingWake' },
                    { text: "üõ°Ô∏è Use the amulet to seal them forever", nextScene: 'endingSeal' }
                ]
            },
            finalWithSheriff: {
                desc: `Hayes faces the shadow man. "I am the last Hayes, keeper of the oath. This ends." He speaks old words from the Bible. The shadow man screams and collapses into mist. The sarcophagi crack and turn to dust. Hayes turns to you: "It's done. The Varnes are no more. Shadowbrook can rest." You've solved the mystery ‚Äî and ended the curse.`,
                choices: [ { text: "üåü Victory. Restart?", nextScene: 'intro' } ]
            },
            endingWake: {
                desc: `You speak the rite. The sarcophagi lids slide open. Ancient forms stir, but they are not human ‚Äî they are shadows wearing flesh. They thank you and offer you a place among them. You become the new guardian, forever bound to the underground. The town forgets you. (END: Shadow keeper)`,
                choices: [ { text: "üîÑ Restart", nextScene: 'intro' } ]
            },
            endingSeal: {
                desc: `You press the amulet to the altar. A shockwave throws you back ‚Äî the chamber collapses. You wake above ground at dawn. The chapel is gone, replaced by a spring. The shadow man is only a legend now. You've brought peace to Shadowbrook.`,
                choices: [ { text: "üçÇ Mystery solved. Restart?", nextScene: 'intro' } ]
            },
            roomLater: {
                desc: `Back in your room, restless, you pack your things. But something slides under the door ‚Äî a photograph of you, taken through the window. A message: "Last warning." You leave town at sunrise, story unfinished. (END: Driven away)`,
                choices: [ { text: "üîÑ Try again", nextScene: 'intro' } ]
            }
        };

        // Helper to apply action from choice
        function applyAction(choice) {
            if (choice.action) {
                choice.action();
            }
        }

        // Render current scene based on gameState.currentSceneId
        function renderScene() {
            const sceneId = gameState.currentSceneId;
            const scene = scenes[sceneId];
            if (!scene) {
                // fallback
                document.getElementById('storyText').innerText = "Something went wrong in the fog...";
                return;
            }

            // Filter choices that have conditions
            let availableChoices = scene.choices;
            if (scene.choices) {
                availableChoices = scene.choices.filter(ch => {
                    if (ch.condition && typeof ch.condition === 'function') {
                        return ch.condition();
                    }
                    return true;
                });
            }

            // Display description
            document.getElementById('storyText').innerText = scene.desc;

            // Render choice buttons
            const choicesDiv = document.getElementById('choicesContainer');
            choicesDiv.innerHTML = '';
            if (availableChoices.length === 0) {
                // In case no choices, add restart option
                const restartBtn = document.createElement('button');
                restartBtn.className = 'choice-btn';
                restartBtn.innerText = 'üîÅ Restart';
                restartBtn.addEventListener('click', () => {
                    resetGame();
                });
                choicesDiv.appendChild(restartBtn);
            } else {
                availableChoices.forEach((choice, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'choice-btn';
                    btn.innerText = choice.text;
                    btn.addEventListener('click', () => {
                        applyAction(choice);
                        if (choice.nextScene) {
                            gameState.currentSceneId = choice.nextScene;
                            renderScene();
                        } else {
                            console.warn('no nextScene');
                        }
                    });
                    choicesDiv.appendChild(btn);
                });
            }

            // Update small clue panel (shows some flags but not spoilers)
            const clueDiv = document.getElementById('inventoryInfo');
            let clueText = '';
            if (gameState.shadowAmulet) clueText += 'ü™¨ amulet ';
            if (gameState.diaryFound) clueText += 'üìñ diary ';
            if (gameState.libraryClue) clueText += 'üó∫Ô∏è map ';
            if (gameState.sheriffTrust) clueText += 'üëÆ trust ';
            if (gameState.metGhost) clueText += 'üëª ghost ';
            if (clueText === '') clueText = 'no clues yet';
            clueDiv.innerText = 'üîç ' + clueText;
        }

        // Reset game to beginning with fresh state
        function resetGame() {
            gameState = {
                talkedMartha: false,
                metGhost: false,
                libraryClue: false,
                sheriffTrust: false,
                cemeteryVisited: false,
                shadowAmulet: false,
                diaryFound: false,
                shadowManRevealed: false,
                eldritchSecret: false,
                currentSceneId: 'intro'
            };
            renderScene();
        }

        // Attach restart button
        document.getElementById('restartBtn').addEventListener('click', resetGame);

        // Initial render
        renderScene();

        // (Optional) Save/Load not needed, but we ensure state is mutable.
    })();
</script>
</body>
</html>
