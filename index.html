<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>stillwater ¬∑ scholarship (demo)</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            background: black;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Courier New', 'Georgia', 'Times New Roman', serif;
            padding: 16px;
            margin: 0;
        }
        .game-wrapper {
            width: 100%;
            max-width: 820px;
            background: black;
            box-shadow: 0 0 40px rgba(70, 130, 200, 0.2);
            border-radius: 32px;
            border: 1px solid #1e3a4a;
            padding: 24px 22px;
        }
        /* ambient light bloom effect */
        .light-panel {
            background: #0b0c0e;
            border-radius: 28px;
            padding: 20px 22px;
            box-shadow: 0 0 60px #1f4b6e33, inset 0 0 20px #0a283a;
            transition: box-shadow 0.5s ease;
            border: 1px solid #2b5068;
        }
        .story-window {
            min-height: 260px;
            background: #020405;
            border-radius: 24px;
            padding: 28px 24px;
            color: #c6d9e8;
            font-size: 1.24rem;
            line-height: 1.6;
            text-shadow: 0 0 5px #6fa8dc70, 0 2px 3px black;
            letter-spacing: 0.2px;
            white-space: pre-wrap;
            border-left: 3px solid #2d6380;
            border-bottom: 2px solid #1d445a;
            transition: all 0.3s;
            font-weight: 400;
            box-shadow: inset 0 0 30px #07161f;
        }
        .story-window.pressure {
            box-shadow: inset 0 0 40px #420d0d;
            border-left-color: #8b4f4f;
            color: #d4c0c0;
            transition: 1s;
        }
        .choices-container {
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin: 28px 0 20px;
        }
        .choice-btn {
            background: transparent;
            border: 2px solid #395e74;
            color: #bdd4e0;
            padding: 16px 22px;
            font-size: 1.2rem;
            border-radius: 50px;
            text-align: left;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            backdrop-filter: blur(2px);
            transition: all 0.2s;
            box-shadow: 0 4px 0 #142d38, 0 5px 15px black;
            letter-spacing: 0.4px;
        }
        .choice-btn:hover {
            border-color: #7ba6c2;
            color: #edf5fc;
            background: #0f2e3d50;
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #1d3845, 0 8px 20px black;
        }
        .choice-btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #1d3845, 0 5px 12px black;
        }
        .bottom-panel {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            gap: 16px;
            flex-wrap: wrap;
            margin-top: 16px;
        }
        .memory-journal {
            background: #0a151f;
            border-radius: 40px;
            padding: 14px 22px;
            color: #aac7db;
            font-size: 1.0rem;
            border: 1px solid #316280;
            min-height: 60px;
            flex: 2;
            min-width: 240px;
            box-shadow: inset 0 0 15px black;
            font-style: italic;
            border-left: 6px solid #5c3d2e;
            word-break: break-word;
        }
        .pressure-tag {
            background: #180f0f;
            border-radius: 40px;
            padding: 10px 25px;
            color: #9fbbd0;
            border: 1px solid #4f5f6b;
            font-size: 1.0rem;
            text-align: center;
            box-shadow: inset 0 0 8px black;
            letter-spacing: 1px;
        }
        .restart-btn {
            background: black;
            border: 1px solid #2e5b70;
            color: #779bb3;
            padding: 10px 26px;
            border-radius: 60px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.2s;
            font-family: inherit;
        }
        .restart-btn:hover {
            background: #162831;
            color: #d2e5f5;
            border-color: #9cbdd6;
        }
        .typed-cursor {
            opacity: 1;
            animation: blink 0.9s infinite;
            color: #80b5dc;
        }
        @keyframes blink {
            0%, 100% { opacity:1; }
            50% { opacity:0; }
        }
    </style>
</head>
<body>
<div class="game-wrapper">
    <div class="light-panel" id="lightPanel">
        <div id="storyDisplay" class="story-window" id="storyWindow">
            <!-- dynamic text inserted here -->
        </div>

        <div id="choicesArea" class="choices-container"></div>

        <div class="bottom-panel">
            <div id="journalBox" class="memory-journal">‚ùÑÔ∏è she notices...</div>
            <div id="pressureDisplay" class="pressure-tag">‚èé weight ¬∑ light</div>
            <button id="restartButton" class="restart-btn">‚Üª restart demo</button>
        </div>
    </div>
</div>
<script>
    (function() {
        // --------------------------------------------------------------
        // VERTICAL SLICE: Stillwater Scholarship (Act I opening)
        // Living text, pressure, memory journal, 20-30 min demo
        // --------------------------------------------------------------

        // ----- GAME STATE (minimal, only for this slice) -----
        let state = {
            // personality axes (hidden)
            reserved: 2,           // 1-5 : 1=confrontational,5=reserved
            invested: 2,           // 1-5 : emotional investment
            trusting: 3,           // 1-5 : trusting ‚Üî skeptical
            // pressure (0-10) affects text & light
            pressure: 2,
            // memory fragments (journal)
            memory: [
                "the scholarship name is everywhere. Stillwater. like the town is holding still for someone.",
                "the woman at the bus station smiled too long."
            ],
            // relationships (simple)
            marleneImpression: 0,    // -2 to +2
            // flags
            metLandlord: false,
            walkedAlone: false,
            heardWhisper: false,
            // scene control
            currentScene: 'busArrival',
            // for living text engine
            textQueue: [],
            isPrinting: false,
            skipRequest: false,
            charIndex: 0,
            currentFullText: '',
            afterPrintCallback: null,
            speakerRate: 1.0,   // modifier for pauses
        };

        // ----- helper: add memory line (accumulates) -----
        function addMemory(newLine) {
            if (state.memory.length >= 5) state.memory.shift();
            state.memory.push(newLine);
            updateJournal();
        }

        // ----- update journal display -----
        function updateJournal() {
            const journalDiv = document.getElementById('journalBox');
            let latest = state.memory[state.memory.length-1] || "she waits.";
            if (state.memory.length > 1) {
                // show faint previous
                const prev = state.memory[state.memory.length-2];
                journalDiv.innerHTML = `<span style="opacity:0.5; font-size:0.9rem;">‚úé </span>${latest}<br><span style="opacity:0.3; font-size:0.85rem;">‚ãØ ${prev}</span>`;
            } else {
                journalDiv.innerHTML = `‚úé ${latest}`;
            }
        }

        // ----- update pressure UI and ambient style -----
        function updatePressure() {
            const pressureDiv = document.getElementById('pressureDisplay');
            let desc = '';
            if (state.pressure <= 2) desc = '‚èé weight ¬∑ light';
            else if (state.pressure <= 5) desc = '‚èé weight ¬∑ gathering';
            else if (state.pressure <= 8) desc = '‚èé weight ¬∑ heavy';
            else desc = '‚èé weight ¬∑ suffocating';
            pressureDiv.innerText = desc;

            const storyWin = document.getElementById('storyDisplay');
            const lightPanel = document.getElementById('lightPanel');
            if (state.pressure >= 6) {
                storyWin.classList.add('pressure');
                lightPanel.style.boxShadow = '0 0 70px #6e2a2a66, inset 0 0 30px #4a1e1e';
            } else {
                storyWin.classList.remove('pressure');
                lightPanel.style.boxShadow = '0 0 60px #1f4b6e33, inset 0 0 20px #0a283a';
            }
        }

        // ----- living text printer with speed based on speaker, pressure, and interruptions -----
        function typeText(fullText, callback, speaker='narrator') {
            if (state.isPrinting) {
                // if already printing, queue this text
                state.textQueue.push({fullText, callback, speaker});
                return;
            }
            state.isPrinting = true;
            state.currentFullText = fullText;
            state.charIndex = 0;
            const storyElem = document.getElementById('storyDisplay');
            storyElem.innerHTML = ''; // clear

            // base speed: higher pressure = slower, plus speaker modifiers
            let baseDelay = 20 + (state.pressure * 2.5); // 20‚Äì45 ms
            if (speaker === 'nervous') baseDelay += 20;
            else if (speaker === 'confident') baseDelay = Math.max(15, baseDelay-8);
            else if (speaker === 'lying') baseDelay += 12; // too smooth? we add tiny jitter

            function printStep() {
                if (state.skipRequest) {
                    // instantly show full text
                    storyElem.innerHTML = fullText;
                    state.isPrinting = false;
                    state.skipRequest = false;
                    if (callback) callback();
                    // check queue
                    if (state.textQueue.length > 0) {
                        const next = state.textQueue.shift();
                        typeText(next.fullText, next.callback, next.speaker);
                    }
                    return;
                }

                if (state.charIndex < fullText.length) {
                    // occasional interruption chance? if high pressure, sometimes add pause dots
                    let chunk = fullText[state.charIndex];
                    // simulate nervous pauses / corrections if speaker nervous and random
                    if (speaker === 'nervous' && Math.random() < 0.1 && state.charIndex > 0 && fullText[state.charIndex-1] !== ' ') {
                        chunk = '.. ' + chunk;
                    }
                    // lying: occasionally too smooth ‚Äî but we just add tiny delay.
                    storyElem.innerHTML += chunk;
                    state.charIndex++;

                    let delay = baseDelay;
                    // vary by punctuation
                    if (fullText[state.charIndex-1] === '.' || fullText[state.charIndex-1] === '?' || fullText[state.charIndex-1] === '!') {
                        delay = 350 + (state.pressure * 20);
                    } else if (fullText[state.charIndex-1] === ',') {
                        delay = 160 + (state.pressure * 6);
                    } else if (fullText[state.charIndex-1] === '‚Äî') {
                        delay = 280;
                    }
                    setTimeout(printStep, delay);
                } else {
                    state.isPrinting = false;
                    if (callback) callback();
                    // process next in queue
                    if (state.textQueue.length > 0) {
                        const next = state.textQueue.shift();
                        typeText(next.fullText, next.callback, next.speaker);
                    }
                }
            }
            printStep();
        }

        // skip typing (if user clicks)
        function skipTyping() {
            if (state.isPrinting) {
                state.skipRequest = true;
            }
        }

        // ----- choices rendering -----
        function showChoices(choicesArray) {
            const container = document.getElementById('choicesArea');
            container.innerHTML = '';
            choicesArray.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                btn.innerText = choice.text;
                btn.addEventListener('click', (e) => {
                    // disable all to avoid double-click
                    document.querySelectorAll('.choice-btn').forEach(b => b.disabled = true);
                    if (choice.action) choiceAction(choice.action);
                    if (choice.nextScene) {
                        // small pressure bump on choice
                        state.pressure = Math.min(10, state.pressure + (choice.pressureDelta || 0.5));
                        updatePressure();
                        goToScene(choice.nextScene);
                    }
                });
                container.appendChild(btn);
            });
        }

        function choiceAction(actionDef) {
            if (!actionDef) return;
            // actions can be functions or shorthand strings
            if (typeof actionDef === 'function') {
                actionDef();
            } else if (actionDef === 'metLandlord') {
                state.metLandlord = true;
                addMemory("the landlord, marlene, smells like cigarettes. she says 'make yourself invisible.'");
                state.marleneImpression -= 1; // cold
            } else if (actionDef === 'walkAlone') {
                state.walkedAlone = true;
                addMemory("walking alone ‚Äî storefronts like frozen faces. someone watches from a window.");
                state.reserved = Math.min(5, state.reserved+1);
            } else if (actionDef === 'acceptRide') {
                addMemory("marlene drove me. didn't ask. just said 'get in.'");
                state.marleneImpression += 1;
            } else if (actionDef === 'overhear') {
                state.heardWhisper = true;
                addMemory("whisper at the gas station: 'stillwater kid. like the other one.'");
                state.pressure = Math.min(10, state.pressure+2);
                updatePressure();
            } else if (actionDef === 'stayQuiet') {
                addMemory("i stayed quiet. marlene's tv hums. the town hums back.");
                state.reserved = Math.min(5, state.reserved+1);
            }
        }

        // scene definitions (demo slice)
        const scenes = {
            busArrival: {
                desc: "GREYHOUND STATION, 4:47 PM ‚Äî \nLake-effect snow dusts the parking lot. You step off the bus with one duffel. The sign overhead: WELCOME TO STILLWATER. Beneath it, someone has scratched '‚Ä¶if you can.'\n\nA woman in a worn coat approaches. 'You're the scholarship kid. Marlene. I'm your landlord. Let's go.' She doesn't offer to carry anything.",
                speaker: 'narrator',
                choices: [
                    { text: "üö∂ thanks, but i'd rather walk. get a feel for the town.", nextScene: 'firstWalk', action: 'walkAlone', pressureDelta: 0.2 },
                    { text: "üöó nod and get in the car. don't want to start rude.", nextScene: 'carRide', action: 'acceptRide', pressureDelta: 0 },
                    { text: "‚ùì ask about the scratched sign ‚Äî 'if you can' what?", nextScene: 'askSign', pressureDelta: 0.8 }
                ]
            },
            askSign: {
                desc: "Marlene glances at the sign, then at you. 'Someone's idea of a joke.' Her jaw tightens. 'You ask a lot of questions for someone who just got here.' The air thickens. You regret it slightly.",
                speaker: 'marlene',
                choices: [
                    { text: "üòê 'sorry. long ride.' get in the car quietly.", nextScene: 'carRide', action: 'acceptRide', pressureDelta: -0.3 },
                    { text: "üë£ still, i'll walk. need to clear my head.", nextScene: 'firstWalk', action: 'walkAlone', pressureDelta: 0.3 }
                ]
            },
            firstWalk: {
                desc: "You walk down Main Street. Half the storefronts are empty, but the ones that remain feel frozen: a diner, a hardware store, a church with a boarded window. Through the gas station window, you hear a woman's voice: '‚Äîanother Stillwater kid. like the last one.' Her friend shushes her. They see you seeing them.",
                speaker: 'nervous',
                choices: [
                    { text: "üëÇ pause, pretend to check your phone. try to hear more.", nextScene: 'overhearMore', action: 'overhear', pressureDelta: 1.2 },
                    { text: "üèÉ keep walking. act like you didn't notice.", nextScene: 'afterWalk', action: 'stayQuiet', pressureDelta: -0.2 }
                ]
            },
            overhearMore: {
                desc: "'‚Äîshe died, that's what. drowned. but they call it accident.' The second voice hisses: 'shut up, she's right there.' You feel their stares burn the back of your neck. The snow gets heavier.",
                speaker: 'whisper',
                choices: [
                    { text: "üò∂ walk faster. apartment now.", nextScene: 'arriveHome', action: null, pressureDelta: 1.5 }
                ]
            },
            afterWalk: {
                desc: "You pass the diner. A bell rings faintly. Everything feels watched. You finally find the address ‚Äî a grey house with a porch light flickering.",
                speaker: 'narrator',
                choices: [
                    { text: "üö™ enter. marlene's waiting.", nextScene: 'arriveHome', action: null }
                ]
            },
            carRide: {
                desc: "Marlene's car smells of ash and pine. She drives in silence, then mutters: 'Don't go to the docks at night. Kids think it's fun. It's not.' You pass the academy‚Äîgranite pillars, a sign: STILLWATER ACADEMY ¬∑ EST. 1892.",
                speaker: 'marlene',
                choices: [
                    { text: "üèõÔ∏è 'what's the academy like?'", nextScene: 'askAcademy', pressureDelta: 0.2 },
                    { text: "ü™∂ stay silent. watch the town slide by.", nextScene: 'silentRide', action: 'stayQuiet', pressureDelta: -0.3 }
                ]
            },
            askAcademy: {
                desc: "Marlene snorts. 'It's why the town's still breathing. Donors, grants, kids with parents who pay more than our houses. You're one of them now. Sort of.' She pulls up to a narrow house. 'Room's upstairs. Don't touch the thermostat.'",
                speaker: 'marlene',
                choices: [
                    { text: "üì¶ go inside. unpack.", nextScene: 'arriveHome', action: null }
                ]
            },
            silentRide: {
                desc: "You watch the houses shrink and age. Marlene parks. 'Here. I'll show you the room.'",
                speaker: 'narrator',
                choices: [ { text: "‚¨ÜÔ∏è go inside", nextScene: 'arriveHome' } ]
            },
            arriveHome: {
                desc: "Your room is small, a single bed, a desk with a lamp that hums. Through the window, you see the academy's spire, and beyond it‚Äîthe grey lake. A binder on the desk: 'SCHOLARSHIP HANDBOOK ¬∑ STILLWATER FOUNDATION.' You open it. The first page reads: 'You have been chosen to represent the vision of the Stillwater family.' A photo of a smiling old man. Elias Stillwater. Died 1989. But his name is everywhere.",
                speaker: 'narrator',
                choices: [
                    { text: "üìñ read more about the foundation", nextScene: 'handbook', pressureDelta: 0.5 },
                    { text: "ü™ü just look at the lake. think.", nextScene: 'lookLake', pressureDelta: -0.2 }
                ]
            },
            handbook: {
                desc: "You flip through ‚Äî history, donors, rules. A section catches your eye: 'memorial scholarships in honor of those lost.' The list includes a Catherine Few, '1988.' A sticky note, half-peeled, says: 'ask marlene about catherine.'",
                speaker: 'narrator',
                choices: [
                    { text: "‚ùì go find Marlene. ask about Catherine.", nextScene: 'askMarleneCatherine', pressureDelta: 1.0 },
                    { text: "üìì write it down. wait.", nextScene: 'waitDontAsk', action: ()=>addMemory("catherine few. 1988. i'll ask later.") }
                ]
            },
            lookLake: {
                desc: "The lake is steel-grey. A gull cries. You feel very far from anywhere. A thought: someone else stood at this window. Before.",
                speaker: 'narrator',
                choices: [ { text: "üåô rest. tomorrow is orientation.", nextScene: 'endDemo' } ]
            },
            askMarleneCatherine: {
                desc: "Marlene is in the kitchen, smoking by the window. You ask about Catherine Few. She freezes. 'How do you know that name?' You mention the sticky note. She stubs the cigarette. 'She was a scholarship kid. Like you. Drowned. 1988. They said she couldn't swim. But she could. I taught her myself.' Her voice cracks. 'Don't end up like her.'",
                speaker: 'marlene',
                choices: [ { text: "‚Ä¶ i won't. (end of demo preview)", nextScene: 'endDemo' } ]
            },
            waitDontAsk: {
                desc: "You put the handbook down. The room darkens. Somewhere a dog barks once. This town holds its breath.",
                speaker: 'narrator',
                choices: [ { text: "üåå end demo ‚Äî to be continued", nextScene: 'endDemo' } ]
            },
            endDemo: {
                desc: "‚ùÑÔ∏è END OF VERTICAL SLICE ‚Äî STILLWATER SCHOLARSHI P‚ùÑÔ∏è\n\nYou've felt the weight. The town holds more. (restart to replay)",
                speaker: 'narrator',
                choices: [ ]
            }
        };

        function goToScene(sceneId) {
            const scene = scenes[sceneId];
            if (!scene) return;
            // update scene
            state.currentScene = sceneId;
            const speaker = scene.speaker || 'narrator';
            // clear choices while typing
            document.getElementById('choicesArea').innerHTML = '';
            typeText(scene.desc, () => {
                if (scene.choices && scene.choices.length > 0) {
                    showChoices(scene.choices);
                } else {
                    // if no choices, maybe add restart
                    if (sceneId === 'endDemo') {
                        const container = document.getElementById('choicesArea');
                        const restartBtn = document.createElement('button');
                        restartBtn.className = 'choice-btn';
                        restartBtn.innerText = '‚Üª replay demo';
                        restartBtn.addEventListener('click', () => resetGame());
                        container.appendChild(restartBtn);
                    }
                }
            }, speaker);
        }

        // skip on click story
        document.getElementById('storyDisplay').addEventListener('click', skipTyping);

        function resetGame() {
            state = {
                reserved: 2, invested: 2, trusting: 3,
                pressure: 2,
                memory: [
                    "the scholarship name is everywhere. Stillwater. like the town is holding still for someone.",
                    "the woman at the bus station smiled too long."
                ],
                marleneImpression: 0,
                metLandlord: false,
                walkedAlone: false,
                heardWhisper: false,
                currentScene: 'busArrival',
                textQueue: [],
                isPrinting: false,
                skipRequest: false,
                charIndex: 0,
                currentFullText: '',
                afterPrintCallback: null,
                speakerRate: 1.0,
            };
            updateJournal();
            updatePressure();
            goToScene('busArrival');
        }

        // init
        updateJournal();
        updatePressure();
        goToScene('busArrival');

        // restart button
        document.getElementById('restartButton').addEventListener('click', resetGame);
    })();
</script>
</body>
</html>
